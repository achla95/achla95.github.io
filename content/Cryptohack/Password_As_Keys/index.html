<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/css/styles.css"> <!-- for navbar-->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <title>CryptoHack : Passwords as Keys</title>
</head>
<body>
    <div class="nav-bar">
        <div class="logo">
            <img src="/img/logo.png" alt="logoImg">
        </div>
        <ul class="nav-links">
            <li>
                <a href="/index.html" target="_blank"><span style="color: #362F58; background-color: #fff; padding: 12px 16px;">Home</span></a>
            </li>
            <li>
                <a href="#" target="_blank">Whoami</a>
            </li>
            <li>
                <a href="#" target="_blank">Projects</a>
            </li>
            <li>
                <input type="checkbox" class="checkbox" id="chk" />
                <label class="label" for="chk">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 1049.000000 1280.000000" preserveAspectRatio="xMidYMid meet"> <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="#f1c40f" stroke="none"><path d="M6015 12789 c-740 -46 -1469 -219 -2145 -509 -284 -121 -817 -407 -985 -528 -22 -15 -108 -77 -191 -136 -179 -126 -366 -275 -521 -412 -163 -144 -375 -344 -398 -375 -11 -15 -63 -74 -115 -131 -1223 -1342 -1815 -3153 -1624 -4968 153 -1459 796 -2809 1835 -3849 665 -665 1429 -1156 2315 -1486 406 -151 865 -268 1304 -330 341 -48 510 -59 900 -59 374 -1 519 8 810 45 85 11 182 23 215 25 33 3 121 19 195 35 707 160 1097 293 1625 554 386 191 672 366 1000 612 261 196 285 223 237 271 -17 17 -43 20 -233 25 -1742 51 -3386 839 -4545 2177 -1184 1368 -1717 3206 -1453 5010 218 1494 969 2854 2124 3849 116 100 115 98 115 132 0 52 -22 59 -186 58 -82 -1 -207 -6 -279 -10z"/></g></svg>
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0 0 48 48" style=" fill:#f39c12;"><path fill="#FF9800" d="M11 11H37V37H11z"></path><path fill="#FF9800" d="M11.272 11.272H36.728V36.728H11.272z" transform="rotate(-45.001 24 24)"></path><path fill="#FFEB3B" d="M13,24c0,6.077,4.923,11,11,11c6.076,0,11-4.923,11-11s-4.924-11-11-11C17.923,13,13,17.923,13,24"></path></svg>
                    <div class="ball"></div>
                </label>
                
            </li>
        </ul>
        <div class="burger">
            <div class="row1"></div>
            <div class="row2"></div>
            <div class="row3"></div>
        </div>
    </div>
    <div class="header">
        <article>
            <h2> CryptoHack : Passwords as Keys</h2>
            <div class="decoration">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#362F58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <time class="published" datetime="2021-08-14T00:00:00+02:00"> jeu. 5 avril 2022 </time>
                <b>·</b>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#362F58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <label>achla</label>
                <b>·</b>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#362F58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                <label>medium</label>
                </div>
                <p>On se retrouve pour un write-up vidéo d'un challenge venant de <a href="https://cryptohack.org" target="_blank" style="text-decoration: none; color: #6D4AFF;">CryptoHack</a>.</p>
                <p>
                    Énoncé : 
                    It is essential that keys in symmetric-key algorithms are random bytes, instead of passwords or other predictable data. The random bytes should be generated using a cryptographically-secure pseudorandom number generator (CSPRNG). If the keys are predictable in any way, then the security level of the cipher is reduced and it may be possible for an attacker who gets access to the ciphertext to decrypt it.
                
                    Just because a key looks like it is formed of random bytes, does not mean that it necessarily is. In this case the key has been derived from a simple password using a hashing function, which makes the ciphertext crackable.
                    For this challenge you may script your HTTP requests to the endpoints, or alternatively attack the ciphertext offline. Good luck!
                    Play at <a href="http://aes.cryptohack.org/passwords_as_keys" target="_blank" style="color: #6D4AFF;">http://aes.cryptohack.org/passwords_as_keys</a>
                </p>
                <p>
                    En se rendant sur le lien spécifié ci-dessus, nous voyons le script python qui permet de chiffrer et déchiffrer le flag : 
                    <!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid #362F58;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                        <pre style="margin: 0; line-height: 125%">
<span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">Crypto.Cipher</span> <span style="color: #AA22FF; font-weight: bold">import</span> AES
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">hashlib</span>
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">random</span>
<span style="color: #008800; font-style: italic"># /usr/share/dict/words from</span>
<span style="color: #008800; font-style: italic"># https://gist.githubusercontent.com/wchargin/8927565/raw/d9783627c731268fb2935a731a618aa8e95cf465/words</span>
<span style="color: #AA22FF; font-weight: bold">with</span> <span style="color: #AA22FF">open</span>(<span style="color: #BB4444">&quot;/usr/share/dict/words&quot;</span>) <span style="color: #AA22FF; font-weight: bold">as</span> f:
        words <span style="color: #666666">=</span> [w<span style="color: #666666">.</span>strip() <span style="color: #AA22FF; font-weight: bold">for</span> w <span style="color: #AA22FF; font-weight: bold">in</span> f<span style="color: #666666">.</span>readlines()]
        keyword <span style="color: #666666">=</span> random<span style="color: #666666">.</span>choice(words)
        KEY <span style="color: #666666">=</span> hashlib<span style="color: #666666">.</span>md5(keyword<span style="color: #666666">.</span>encode())<span style="color: #666666">.</span>digest()
        FLAG <span style="color: #666666">=</span> <span style="border: 1px solid #FF0000">?</span>
    
    
<span style="color: #AA22FF">@chal.route</span>(<span style="color: #BB4444">&#39;/passwords_as_keys/decrypt/&lt;ciphertext&gt;/&lt;password_hash&gt;/&#39;</span>)
<span style="color: #AA22FF; font-weight: bold">def</span> <span style="color: #00A000">decrypt</span>(ciphertext, password_hash):
    ciphertext <span style="color: #666666">=</span> <span style="color: #AA22FF">bytes</span><span style="color: #666666">.</span>fromhex(ciphertext)
    key <span style="color: #666666">=</span> <span style="color: #AA22FF">bytes</span><span style="color: #666666">.</span>fromhex(password_hash)
    
    cipher <span style="color: #666666">=</span> AES<span style="color: #666666">.</span>new(key, AES<span style="color: #666666">.</span>MODE_ECB)
    <span style="color: #AA22FF; font-weight: bold">try</span>:
        decrypted <span style="color: #666666">=</span> cipher<span style="color: #666666">.</span>decrypt(ciphertext)
    <span style="color: #AA22FF; font-weight: bold">except</span> <span style="color: #D2413A; font-weight: bold">ValueError</span> <span style="color: #AA22FF; font-weight: bold">as</span> e:
         <span style="color: #AA22FF; font-weight: bold">return</span> {<span style="color: #BB4444">&quot;error&quot;</span>: <span style="color: #AA22FF">str</span>(e)}
    
    <span style="color: #AA22FF; font-weight: bold">return</span> {<span style="color: #BB4444">&quot;plaintext&quot;</span>: decrypted<span style="color: #666666">.</span>hex()}
    
<span style="color: #AA22FF">@chal.route</span>(<span style="color: #BB4444">&#39;/passwords_as_keys/encrypt_flag/&#39;</span>)
<span style="color: #AA22FF; font-weight: bold">def</span> <span style="color: #00A000">encrypt_flag</span>():
    cipher <span style="color: #666666">=</span> AES<span style="color: #666666">.</span>new(KEY, AES<span style="color: #666666">.</span>MODE_ECB)
    encrypted <span style="color: #666666">=</span> cipher<span style="color: #666666">.</span>encrypt(FLAG<span style="color: #666666">.</span>encode())
    
    <span style="color: #AA22FF; font-weight: bold">return</span> {<span style="color: #BB4444">&quot;ciphertext&quot;</span>: encrypted<span style="color: #666666">.</span>hex()}
</pre></div>

    
                </p>
                <p>
                    On remarque la clé utilisée pour chiffrer le flag est issue d'une wordlist, à partir de la rien de compliqué il nous suffit
                    juste de récupérer cette wordlist puis de hasher tout les mots. Enfin, nous devons déchiffrer le flag avec tous les mots que nous venont de hasher
                </p>
                <p>
                    Pour cela j'ai fait un petit script python qui permet d'automatiser cette opération : 
                    <div style="background: #f8f8f8; overflow:auto;width:auto;border:solid #362F58;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="margin: 0; line-height: 125%"><span style="color: #AA22FF; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">Crypto.Cipher</span> <span style="color: #AA22FF; font-weight: bold">import</span> AES
<span style="color: #AA22FF; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">hashlib</span>

<span style="color: #AA22FF; font-weight: bold">with</span> <span style="color: #AA22FF">open</span>(<span style="color: #BB4444">&quot;C:</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">Users</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">achla95</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">Documents</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">CryptoHack</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">AES_Second_Part</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BB4444">words&quot;</span>, encoding<span style="color: #666666">=</span><span style="color: #BB4444">&quot;utf-8&quot;</span>) <span style="color: #AA22FF; font-weight: bold">as</span> f:
    words <span style="color: #666666">=</span> [w<span style="color: #666666">.</span>strip() <span style="color: #AA22FF; font-weight: bold">for</span> w <span style="color: #AA22FF; font-weight: bold">in</span> f<span style="color: #666666">.</span>readlines()]
    hashed_words <span style="color: #666666">=</span> []
    <span style="color: #AA22FF; font-weight: bold">for</span> w <span style="color: #AA22FF; font-weight: bold">in</span> words:
        hashed_words<span style="color: #666666">.</span>append(hashlib<span style="color: #666666">.</span>md5(w<span style="color: #666666">.</span>encode())<span style="color: #666666">.</span>digest())
        ciphertext <span style="color: #666666">=</span> <span style="color: #BB4444">&quot;c92b7734070205bdf6c0087a751466ec13ae15e6f1bcdd3f3a535ec0f4bbae66&quot;</span>
        ciphertext <span style="color: #666666">=</span> <span style="color: #AA22FF">bytes</span><span style="color: #666666">.</span>fromhex(ciphertext)

        <span style="color: #AA22FF; font-weight: bold">for</span> w <span style="color: #AA22FF; font-weight: bold">in</span> hashed_words:
            cipher <span style="color: #666666">=</span> AES<span style="color: #666666">.</span>new(w, AES<span style="color: #666666">.</span>MODE_ECB)
            decrypted<span style="color: #666666">=</span> cipher<span style="color: #666666">.</span>decrypt(ciphertext)
            <span style="color: #AA22FF; font-weight: bold">if</span> decrypted<span style="color: #666666">.</span>hex()<span style="color: #666666">.</span>startswith(<span style="color: #BB4444">&quot;63727970746f&quot;</span>):
            <span style="color: #AA22FF; font-weight: bold">print</span>(f<span style="color: #BB4444">&quot;found hash: {w.hex()}, decrypted : {decrypted.hex()}&quot;</span>)
            <span style="color: #AA22FF; font-weight: bold">break</span>
</pre></div>

    

                </p>
                <p>
                    En quelques mots, on sait que notre flag commence par <span  style="color: #6D4AFF;">crypto{</span>, de là on convertit cela en hexadécimal et on vérifie
                    si notre message déchiffrer commence par : <span style="color: #6D4AFF;">63727970746f</span>, si c'est le cas, le tour est joué, nous avons notre flag.
                </p>
                <p>
                    And Voilà, c'était plutôt simple, je me suis remis à ma crypto récemment et je me rendu compte que je ne connaissais pas le chiffrement AES
                    qui est un chiffrement sécurisé (quand on l'utilise bien) et puissant. La prochaine fois nous nous retrouverons pour un challenge un cran au dessus de celui-ci.
                </p>
            </article>
    </div>
<script src="/js/app.js" type="text/javascript"></script>
</body>
</html>